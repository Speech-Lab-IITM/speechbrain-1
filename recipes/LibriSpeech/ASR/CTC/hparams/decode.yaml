# ################################
# Model: wav2vec2 + DNN + CTC
# Augmentation: SpecAugment
# Authors: Sung-Lin Yeh 2021
# ################################

# Seed needs to be set at top of yaml, before objects with parameters are made
seed: 1986
__set_seed: !apply:torch.manual_seed [!ref <seed>]
tag: tag
output_folder: !ref results/decode_<tag>/<seed>
wer_file: !ref <output_folder>/wer.txt
save_folder: !ref <output_folder>/save
train_log: !ref <output_folder>/train_log.txt

# Data files
data_folder: /nlsasfs/home/nltm-pilot/arunk/Database/Librilight/librispeech_finetuning # e,g./path/to/LibriSpeech
# data_folder: /speech/arun/librispeech_finetuning
# noise/ris dataset will automatically be downloaded
data_folder_rirs: !ref <data_folder>
# train_splits: ["train-clean-100", "train-clean-360", "train-other-500"]
# train_splits: ["train-clean-100"]
train_splits: ["10m_0"]
dev_splits: ["dev-clean"]
test_splits: ["test-clean", "test-other"]
skip_prep: False
ckpt_interval_minutes: 30 # save checkpoint every N min
train_csv: !ref <output_folder>/train.csv
valid_csv: !ref <output_folder>/dev-clean.csv
test_csv:
   # - !ref <output_folder>/dev-clean.csv
   # - !ref <output_folder>/dev-other.csv
   - !ref <output_folder>/test-clean.csv
   - !ref <output_folder>/test-other.csv

auto_mix_prec: False
sample_rate: 16000
sorting: ascending

# With data_parallel batch_size is split into N jobs
# With DDP batch_size is multiplied by N jobs
# Must be 3 per GPU to fit 32GB of VRAM
batch_size: 6
test_batch_size: 32

# Dataloader options
train_dataloader_opts:
   batch_size: !ref <batch_size>

valid_dataloader_opts:
   batch_size: !ref <batch_size>

test_dataloader_opts:
   batch_size: !ref <test_batch_size>

# Decoding parameters
blank_index: 0
bos_index: 1
eos_index: 2


log_softmax: !new:speechbrain.nnet.activations.Softmax
   apply_log: True

ctc_cost: !name:speechbrain.nnet.losses.ctc_loss
   blank_index: !ref <blank_index>

train_logger: !new:speechbrain.utils.train_logger.FileTrainLogger
   save_file: !ref <train_log>

error_rate_computer: !name:speechbrain.utils.metric_stats.ErrorRateStats

cer_computer: !name:speechbrain.utils.metric_stats.ErrorRateStats
   split_tokens: True
